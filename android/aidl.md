AIDL (v0.1)
============

Reversion History
-----------------
* 2017.06.05 [chenwei1][chenwei1]
  - create draft
  - definitions of parameter type and return type
  - update version to 0.1

# Parameter Type and Return Type

- All primitive types in the Java programming language (such as `int`, `long`, `char`, `boolean`, and so on)

  > Boxed types (such as `Integer`, `Long`, `Char`, `Boolean`) are unsupported.

- `String`

- `CharSequence`

- `IBinder`

  Use `Parcel.writeStrongBinder(IBinder)` to pass binder object to remove side and use `IBinder Parcel.readStrongBinder()` to retrieve binder object from remove side.

- AIDL-generated interfaces

  AIDL compiler will use `IBinder` type internally when use AIDL-generated interfaces. That is to say, `IXXXInterface.asBinder()` will be called when call `writeStrongBinder(IBinder)` to pass interface to remove side, and `IXXXInterface.Stub.asInterface(IBinder)` will be called when call `readStrongBinder()` to retrieve interface from remove side.

  ```
  // auto generated file IAidlParameters.java
  /**
     * Interfaces generated by other aidl files can be used as parameter.
     * Note: you should explicitly import the interface even if they are in the same package.
     */
  @Override public com.example.chenwei.debugaidlparameters.IDummy useInterfaceParam(com.example.chenwei.debugaidlparameters.IDummy dummyInterface) throws android.os.RemoteException
  {
  android.os.Parcel _data = android.os.Parcel.obtain();
  android.os.Parcel _reply = android.os.Parcel.obtain();
  com.example.chenwei.debugaidlparameters.IDummy _result;
  try {
  _data.writeInterfaceToken(DESCRIPTOR);
  _data.writeStrongBinder((((dummyInterface!=null))?(dummyInterface.asBinder()):(null)));
  mRemote.transact(Stub.TRANSACTION_useInterfaceParam, _data, _reply, 0);
  _reply.readException();
  _result = com.example.chenwei.debugaidlparameters.IDummy.Stub.asInterface(_reply.readStrongBinder());
  }
  finally {
  _reply.recycle();
  _data.recycle();
  }
  return _result;
  }
  }
  ```

- Parcelable classes

  Parcelable class can be used as parameter type or return type, but you should know the following things:

  - Your parcelable class should implement interface `Parcelable` properly

    ```
    // MyParcelable.java
    public class MyParcelable implements Parcelable {
        protected MyParcelable(Parcel in) {
        }

        public static final Creator<MyParcelable> CREATOR = new Creator<MyParcelable>() {
            @Override
            public MyParcelable createFromParcel(Parcel in) {
                return new MyParcelable(in);
            }

            @Override
            public MyParcelable[] newArray(int size) {
                return new MyParcelable[size];
            }
        };

        @Override
        public int describeContents() {
            return 0;
        }

        @Override
        public void writeToParcel(Parcel dest, int flags) {
        }
    }
    ```

  - Your should add a aidl file to declare the parcelable class, so AIDL can find it and knows that it implements the parcelable protocol

    ```
    // MyParcelable.aidl
    parcelable MyParcelable;
    ```

    > The file name of this aidl file should be the same as the java file. For example, if your java class file name is `MyParcelable.java`, then your aidl file for this parcelable class should be `MyParcelable.aidl`, or import error will throw when compile the aidl file which use this parcelable class.

  - Import your parcelable class to the aidl file which use it as parameter type or return type even if they are in the same package

  - Explicitly define the direction use `in`, `out` or `inout` when your parcelable class use as parameter type or won't compile

  ```
  // IAidlParameters.aidl
  interface IAidlParameters {
      /**
       * Parcelable type used as parameter type and return type.
       *
       * Note:
       *   - you should explicitly import the parcelable class
       *   - you should explicitly define the direction of the parameter
       */
      MyParcelable useParcelableType(in MyParcelable parcelableObj);
  }
  ```

- `List`

  All elements in the `List` must be one of the supported data types in this list or one of the other AIDL-generated interfaces or parcelables you've declared. A `List` may optionally be used as a "generic" class (for example, `List<String>`). The actual concrete class that the other side receivers is always an `ArrayList`, although the method is generated to use the `List` interface.

  e.g. :
  ```
  // IAidlParameters.aidl
  interface IAidlParameters {
      /**
        * List type used as parameter type or return type.
        *
        * Note:
        *   - you should explicitly define the direction of the parameter
        *   - your should use concrete type as T with List<T> when use as parameter, but return type
        *     exempt from this limitation
        *   - primitive type or it's boxed type can not use with List<T>
        *   - T in List<T> can not be List type
        */
      List useListType(in List<String> strings);
      List<String> useListType2(in List<String> strings);
      List useListTypeParcelable(in List<MyParcelable> parcelables);
      List<MyParcelable> useListTypeParcelable2(in List<MyParcelable> parcelables);
      List useListTypeIBinder(in List<IBinder> binders);
      List<IBinder> useListTypeIBinder2(in List<IBinder> binders);

      // The following method signatures won't compile
      //List useListType1(in List listObj);
      //void useListType2(in List<int> integers);
      //void useListType3(in List<Integer> integers);
      //List useListType4(in List<List<String>> strings);
      //List<List<String>> useListType5(in List<List<String>> strings);
  }
  ```

- `Map`

  All elements in the `Map` must be one of the supported data types in this list or one of the other AIDL-generated interfaces or parcelables you've declared. Generic maps, (such as those of the form `Map<String, Integer>` are not supported). The actual concrete class that the other side receivers is always a `HashMap`, although the method is generated to use `Map` interface.)

  ```
  // IAidlParameters.aidl
  interface IAidlParameters {
      /**
       * Map type used as parameter type or return type.
       *
       * Note:
       *   - you should explicitly define the direction of the parameter
       *   - unlike List type, you can not use Map type as parameter type and return type the same time
       *   - can not use Map<K, V> as parameter type or return type, only Map can use
       */
      void useMapTypeAsParameterType(in Map maps);
      Map useMapTypeAsReturnType();

      // The following method signatures won't compile
      //Map useMapType3(in Map maps);
      //void useMapTypeAsParameterType2(in Map<String, String> maps);
      //Map<String, String> useMapTypeAsReturnType2();
  }
  ```

> [Demo porject](https://github.com/weichen2046/demos/tree/master/DebugAIDLParameters) for parameter types and return types here.

[chenwei1]: mailto:weichen2046@gmail.com
